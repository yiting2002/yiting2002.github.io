<!DOCTYPE html>
<html>
  <head>
    <title>PixARK #112</title>
    <meta property="og:image" content="112_0_0_0.png" />
    <style>
      #map {
        height: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #legend {
        font-family: monospace;
        background: #fff;
        padding: 10px 20px 10px 20px;
        margin: 20px;
        border: 3px solid #000;
      }
      #legend ul {
        list-style-type: none;
        padding: 0;
      }
      #legend li {
        padding: 3px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="legend">
      <a target="_blank" href="https://docs.google.com/spreadsheets/d/15LwlFt2_sJv8l3_-Uu6fyssOL9_EuE2-DpF4OcDjcr8/edit">[增加標記]</a>
      <ul>
      <li><span style="color:#75654b">▇</span> 末日之地</li>
      <li><span style="color:#425a5f">▇</span> 黑暗森林</li>
      <li><span style="color:#b3ffdd">▇</span> 冰封之地</li>
      <li><span style="color:#a27f27">▇</span> 黃金秘境</li>
      <li><span style="color:#7171ff">▇</span> 魔法森林</li>
      <li><span style="color:#ffff62">▇</span> 沙漠</li>
      <li><span style="color:#2e962b">▇</span> 沼澤</li>
      <li><span style="color:#22692e">▇</span> 高山林地</li>
      <li><span style="color:#4dc82e">▇</span> 草原</li>
      <li><span style="color:#7eea35">▇</span> 新手草原</li>
      <li><span style="color:#00fbff">▇</span> 深海</li>
      </ul>
    </div>
    <script>
      var map, sheet, marker = new Array();
      function initSheet(data) {
        for (var i = 1; i < data.values.length; i++) {
          //var info = 'X:'+data.values[i][1]+', Y:'+data.values[i][2];
          var info = '['+data.values[i][1]+', '+data.values[i][2]+']';
          if (data.values[i].length > 3) info += '\n'+data.values[i][3];
          var mark = new google.maps.Marker({
            position: new google.maps.LatLng(parseFloat(data.values[i][2]) / 8000, parseFloat(data.values[i][1]) / 8000),
            label: data.values[i][0],
            title: info,
            map: map
          });
          marker.push(mark);
        }
      }
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 0, lng: 0},
          zoom: 1,
          streetViewControl: false,
          mapTypeControl: false
        });

        var mapType = new google.maps.ImageMapType({
          getTileUrl: function(coord, zoom) {
            zoom -= 1;
            if (zoom < 0) return null;
            var scale = 1 << zoom;
            if (coord.x < 0 || coord.x >= scale) return null;
            if (coord.y < 0 || coord.y >= scale) return null;
            return '112_'+zoom+'_'+coord.x+'_'+coord.y+'.png';
          },
          tileSize: new google.maps.Size(450, 450),
          isPng: true,
          maxZoom: 3,
          minZoom: 1,
          name: 'PixARK'
        });

        mapType.projection = {
          fromLatLngToPoint: function(latLng) {
            return new google.maps.Point(
              (latLng.lng() + 0.25) * 450,
              (latLng.lat() + 0.25) * 450);
          },
          fromPointToLatLng: function(point, noWrap) {
            return new google.maps.LatLng(
              point.y * 450 - 0.25,
              point.x * 450 - 0.25,
              true);
          }
        };

        map.mapTypes.set('pixark', mapType);
        map.setMapTypeId('pixark');
        map.controls[google.maps.ControlPosition.LEFT_CENTER].push(document.getElementById('legend'));

        sheet = document.createElement('script');
        sheet.type = 'text/javascript';
        sheet.src = 'https://sheets.googleapis.com/v4/spreadsheets/15LwlFt2_sJv8l3_-Uu6fyssOL9_EuE2-DpF4OcDjcr8/values/map!A:D?key=AIzaSyBokzsCC_kJcT22Uw3cTzilwXLVkqQarKs&callback=initSheet';
        document.getElementsByTagName('head')[0].appendChild(sheet);
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBokzsCC_kJcT22Uw3cTzilwXLVkqQarKs&callback=initMap">
    </script>
  </body>
</html>
